<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Разделяй-и-властвуй</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="../pandoc.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfjBggQFxAS4ilBAAACgElEQVRIx52VS0iUYRSGn/8fzbxMIYoRKSZKi2wGwo2FxRQZIlGbaGUF0b52LWbTLlx0W7VyEZiBWkE5mraRRrJFRUwolQw6zQTeuoiU423eFuk0M//nhJ7dd+Z7n/8932HOscgIgU0lR/Cxn3LKgGlijDJIkAgJiywhZMujVo0qrsyIa1St8shWFnmp/IooW0TkV6mMYuRVQCv6X6woIK+QQ16vkPP2M/WZICHVpyGEvCb5vE7olH6bEV6l1R4w3RpQkYoVNJcSWHsLIUt+rTpvLOuSELqihAmwKr8sgZBHE2aX5UKoRmNmDxPyCBtoodLU1m5yaADC9Jr7XkkLoCqNmPAx1eqqnqhAqEHfzB5GVGXTQLUJ/5xZznGcOuAtQbOHahpsfOQ5f5mng8McZAdnsVigkyUTIA8fGjZ561OpuiRJY6oR2qU35iKGbSqc4GU6qObYmstmYIrH5iIq0JIT+17lupU8BVUsVKsvJgdLtgnbxXZOJ091HAU+0W+0YCnGnvRUlCa+42OdbRHiA3CSbtyZ+q85RDMBfcxxjZKUf5uPO4wwzGsaMwFR1JZe1Jx8uuB4mBtC6LJzXLTZDLKYihziM+fJzfjQGfYC/XxMTy8yaDNEOLWBDznAIcdT7aMRiPI0PR1myGacnn+Zd7ygiUIHwEUjuUAnsdR0D+M20E7k7/knt5ki39guN9uAEPeIr6citIPrOsxQiC9hveIuLylkkgXyKUsR/2CAB8yyEzdhJiliN3aCmzwCCwSl3FfzDL9wYZFAuClJAcSZJoELALFKAWVYvVxkdm3NbDRUs0TqUM021jeU15s2w9YXSxKy9dWWRGx6uVpOyObW+x/B+LEV0hF3cAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wNi0wOFQxNjoyMzoxNiswMjowMLEfSBUAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDYtMDhUMTY6MjM6MTYrMDI6MDDAQvCpAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC" rel="icon" type="image/x-icon" />
  
  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
     (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
     m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
     (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
  
     ym(53961409, "init", {
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true,
          webvisor:true
     });
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/53961409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->
  
  <script>
  // index page width
  document.addEventListener("DOMContentLoaded", function(event) {
    document.getElementsByClassName('contents')[0].parentElement.style.width = "860px";
  });
  </script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Разделяй-и-властвуй</h1>
</header>
<h1 id="разделяй-и-властвуй">Разделяй-и-властвуй</h1>
<p>К концу 50-х годов быстрое преобразование Фурье уже изобрели, но использовали только «по назначению»: для обработки сигналов, а не для умножения чисел.</p>
<p>В это время <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BB%D0%BC%D0%BE%D0%B3%D0%BE%D1%80%D0%BE%D0%B2,_%D0%90%D0%BD%D0%B4%D1%80%D0%B5%D0%B9_%D0%9D%D0%B8%D0%BA%D0%BE%D0%BB%D0%B0%D0%B5%D0%B2%D0%B8%D1%87">Андрей Колмогоров</a> и несколько других пионеров информатики выдвинули «гипотезу <span class="math inline">\(n^2\)</span>»: невозможно перемножить два <span class="math inline">\(n\)</span>-значных числа, быстрее, чем за <span class="math inline">\(O(n^2)\)</span>. Основания на то были: шумеры научились умножать в «в столбик» (сложение <span class="math inline">\(n\)</span> <span class="math inline">\(n\)</span>-значных чисел) как минимум четыре тысячи лет назад, и за это время никто ничего быстрее не придумал.</p>
<p>На очередном научном семинаре с повесткой «давайте это уже докажем» один из его аспирантов неожиданно предъявил новый метод с оценкой сложности <span class="math inline">\(O(n^{\log_2 3})\)</span>, тем самым опровергая гипотезу. Аспиранта звали Анатолий Карацуба.</p>
<h2 id="мастер-теорема">Мастер-теорема</h2>
<p>Алгоритм Карацубы основывается на парадигме «разделяй-и-властвуй». Чтобы понять, почему его асимптотика именно такая, нам понадобится более мощная теорема, которая говорит об асимптотике большого класса «разделяек».</p>
<p><strong>Мастер-теорема.</strong> Пусть имеется рекуррента:</p>
<p><span class="math display">\[
T(n) = \begin{cases}
a T(\frac{n}{b}) + \Theta(n^c), &amp; n &gt; n_0
\\ \Theta(1), &amp; n \leq n_0
\end{cases}
\]</span></p>
<p>Тогда:</p>
<ul>
<li><strong>A.</strong> Если <span class="math inline">\(c &gt; \log_b a\)</span>, то <span class="math inline">\(T(n) = \Theta(n^c)\)</span>.</li>
<li><strong>B.</strong> Если <span class="math inline">\(c = \log_b a\)</span>, то <span class="math inline">\(T(n) = \Theta(n^c \log n)\)</span>.</li>
<li><strong>C.</strong> Если <span class="math inline">\(c &lt; \log_b a\)</span>, то <span class="math inline">\(T(n) = \Theta(n^{\log_b a})\)</span>.</li>
</ul>
<hr />
<p><img src="../img/divide-and-conquer.png" /></p>
<hr />
<p><strong>Доказательство.</strong> Рассмотрим «дерево рекурсии» этого соотношения. В нём будет <span class="math inline">\(log_b n\)</span> уровней. На <span class="math inline">\(k\)</span>-том уровне будет <span class="math inline">\(a^k\)</span> вершин, каждая из которых будет стоить <span class="math inline">\((\frac{n}{b^k})^c\)</span> операций. Просуммируем значения во всех вершинах по всем уровням:</p>
<p><span class="math display">\[
T(n) = \sum_{k=0}^{\log_b n} a^k (\frac{n}{b^k})^c = n^c \sum_{k=0}^{\log_b n} (\frac{a}{b^c})^k
\]</span></p>
<p><strong>A.</strong> Если <span class="math inline">\(c &gt; \log_b a\)</span>, то <span class="math inline">\(\sum (\frac{a}{b^с})^k\)</span> это сумма убывающей геометрической прогрессии, которая не зависит от <span class="math inline">\(n\)</span> и просто равна какой-то константе. Значит, <span class="math inline">\(T(n) = \Theta(n^c)\)</span>.</p>
<p><strong>B.</strong> Если <span class="math inline">\(c = \log_b a\)</span>, то</p>
<p><span class="math display">\[
T(n) = n^c \sum_{k=0}^{\log_b n} (\frac{a}{b^c})^k = n^c \sum_{k=0}^{\log_b n} 1^k = \Theta(n^c \log_b n)
\]</span></p>
<p><strong>C.</strong> Если <span class="math inline">\(c &lt; \log_b a\)</span>, то так как сумма прогрессии асимптотически эквивалентна своему старшему элементу,</p>
<p><span class="math display">\[
T(n) = n^c \sum_{k=0}^{\log_b n} (\frac{a}{b^c})^k = \Theta(n^c (\frac{a}{b^c})^{\log_b n}) = \Theta(n^c \cdot \frac{a^{\log_b n}}{n^c}) = \Theta(a^{\log_b n}) = \Theta(n^{\log_b a})
\]</span></p>
<p><strong>Примечание.</strong> Для более точных оценок асимптотики «мерджа» теорема ничего не говорит. Например, если мердж занимает <span class="math inline">\(\Theta(n \log n)\)</span> и задача разбивается каждый раз на две части, то асимптотика будет равна:</p>
<p><span class="math display">\[
\sum_{k=0}^{\log n} n \log \frac{n}{2^k}
= \sum_{k=0}^{\log n} n (\log n - k)
= n \sum_{k=0}^{\log n} k
= \Theta (n \log^2 n)
\]</span></p>
<p>В то же время эта рекуррента под условия теоремы не попадает. Можно лишь получить неточные границы <span class="math inline">\(\Omega (n \log n)\)</span> и <span class="math inline">\(O(n^{1+\epsilon})\)</span>, если подставить <span class="math inline">\(c = 1\)</span> и <span class="math inline">\(c = 1 + \epsilon\)</span> соответственно. Заметим, что <span class="math inline">\(n \log n\)</span> и <span class="math inline">\(n \log^2 n\)</span> асимптотически меньше <span class="math inline">\(n^{1+\epsilon}\)</span>, каким бы маленьким <span class="math inline">\(\epsilon\)</span> ни был.</p>
<h2 id="алгоритм-карацубы">Алгоритм Карацубы</h2>
<p>Алгоритм Карацубы сводит задачу умножения двух чисел длины <span class="math inline">\(n\)</span> к возведению <span class="math inline">\(n\)</span>-значного числа в квадрат. Для простоты будем считать, что числа бинарные, а n = 2k является степенью двойки. На практике же лучше брать достаточно большое основание, а не двойку — <span class="math inline">\(10^9\)</span>, например.</p>
<p>Оказывается, что умножение и возведение в квадрат, вообще говоря, эквивалентные задачи: так как <span class="math inline">\(4ab=(a+b)^{2}-(a-b)^{2}\)</span>, то вместо умножения двух чисел <span class="math inline">\(a\)</span> и <span class="math inline">\(b\)</span> можно возвести два числа такого же порядка в квадрат и за линейное время сделать несколько сложений и вычитаний.</p>
<p>Итак, нам нужно возвести число x в квадрат. Разобьём его на две части, то есть представим в виде <span class="math inline">\(x = a + 2^k b\)</span>, где числа <span class="math inline">\(a\)</span> и <span class="math inline">\(b\)</span> являются <span class="math inline">\(k\)</span>-значными. Внимание, алгебра:</p>
<p><span class="math display">\[
x^2 = (a + 2^k b)^2 = a^2 + 2^k ((a+b)^2 - a^2 - b^2) + b^2 
\]</span></p>
<p>Выяснилось, что мы можем вместо возведения <span class="math inline">\(n\)</span>-значного числа в квадрат возвести три <span class="math inline">\(\frac{n}{2}\)</span>-значных значных числа в квадрат — <span class="math inline">\(a^2\)</span>, <span class="math inline">\(b^2\)</span> и <span class="math inline">\((a+b)^2\)</span> — и сделать константное количество сложений, вычитаний и сдвигов.</p>
<p>Пролистав пол-экрана выше, можно убедиться, что асимптотика будет <span class="math inline">\(\Theta (n^{\log_2 3}) \approx \Theta (n^{1.58})\)</span>: в данном случае наша задача разбивается на <span class="math inline">\(a = 3\)</span> части в <span class="math inline">\(b = 2\)</span> раз меньшего размера, а объединение происходит за <span class="math inline">\(O(n)\)</span>.</p>
<p>Осталось лишь вспомнить, как мы сводили задачу к возведению в квадрат, и мы получим субквадратичный алгоритм для умножения целых чисел.</p>
<h3 id="развитие-идеи">Развитие идеи</h3>
<p>То же самое можно применить к матричному умножению — это называется <a href="https://ru.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%A8%D1%82%D1%80%D0%B0%D1%81%D1%81%D0%B5%D0%BD%D0%B0">алгоритмом Штрассена</a>. В нём две матрицы разбиваются на <span class="math inline">\(8 = 4 + 4\)</span> частей, перемножаются блочно, и сложной алгеброй от одного из 8 умножений получается избавиться, что даёт асимптотику <span class="math inline">\(O(n^{\log_7 8}) \approx O(n^{2.81})\)</span>.</p>
<p>И в алгоритме Штрассена, и в алгоритме Карацубы можно достичь и лучшей асимптотики, если разбивать объекты на большее число частей. Однако, на практике это не применяется, потому что константа получается слишком высокой.</p>
</body>
</html>
